---
title: "size-term-estimation"
author: "suzanne"
date: "2023-04-13"
output: html_document
---

# Read in libraries, set working directory, source code for doing the size estimation work
```{r, setup}
knitr::opts_knit$set(root.dir = "R:/e2projects_two/activitysim/estimation/2017_2019_data/size_terms")
```

```{r}
library(dplyr)
library(tidyverse)
# for mapping places that have people going to them, but size variables are zero:
library(sf)
library(leaflet)
library(htmlwidgets)
library(stats)
library(data.table)

#put your input data here, outputs will also be written out here
setwd("R:/e2projects_two/activitysim/estimation/2017_2019_data/size_terms")

#this file does the work
source('size_estimation_dest_choice.R')

```

There are 5 estimation files for the following destination types:
regular work location 
school location
non-mandatory tour
work-based subtour aka atwork
intermediate stop aka trip destination

```{r}
work_loc_lu<-read.csv('size_term_17_19_workplace.csv') # work trips
school_loc_lu<-read.csv('size_term_17_19_school.csv')  # school trips
non_mandatory_tour_lu<-read.csv('size_term_17_19_non_mandatory.csv') # non-mandatory primary
wb_sub_lu<- read.csv('size_term_17_19_atwork.csv')
trip_dest_lu<-read.csv('size_term_17_19_trip.csv')

```




write out the list of columns that could be used in the estimation
```{r}

var_list<-c('empedu_p',	# education jobs
            'empfoo_p', # food jobs
            'empgov_p',	# government jobs
            'empind_p',	# industrial job
            'empmed_p',	# medicine jobs?
            'empofc_p',	# office jobs
            'empoth_p',	# other jobs?
            'empret_p',	# retail jobs
            # 'emprsc_p',	# resource jobs
            'empsvc_p',	# service jobs
            'emptot_p',	# total jobs
            'hh_p',	    # number of households?
            'stugrd_p',	
            'stuhgh_p',	
            'stuuni_p',	
            'log_aparks')
all_lu_vars<-data.frame(variable=var_list,Zeros=rep(0,(length(var_list))))
 

```

all vars: empsvc_p, empedu_p,	empfoo_p, empgov_p,	empind_p,	empmed_p,	empofc_p,	empoth_p,	empret_p,	hh_p, log_aparks
## Regular Work Location
```{r workplace_work_low}
estimate_size_terms(work_loc_lu, 
                    outfilename='outputs/workplace_work_low.csv', 
                    select_var_list=c("work_low", 
                                      "empsvc_p","empfoo_p","empedu_p",  "empmed_p",  "empofc_p", "empoth_p",
                                      "empret_p"),
                    all_lu_vars=all_lu_vars)

```


```{r workplace_work_med}
estimate_size_terms(work_loc_lu, 
                    outfilename='outputs/workplace_work_med.csv', 
                    select_var_list=c("work_med", 
                                      "empsvc_p", "empedu_p",	"empfoo_p", "empgov_p",	"empind_p",	
                                      "empmed_p",	"empofc_p",	"empret_p"),
                    all_lu_vars=all_lu_vars)
```

```{r workplace_work_high}
estimate_size_terms(work_loc_lu, 
                    outfilename='outputs/workplace_work_high.csv', 
                    select_var_list=c("work_high", 
                                      "empofc_p", "empsvc_p", "empedu_p",	 "empgov_p",
                                      "empind_p",	"empmed_p",		"empoth_p",	"empret_p"),
                    all_lu_vars=all_lu_vars)
```
```{r workplace_work_very_high}
estimate_size_terms(work_loc_lu, 
                    outfilename='outputs/workplace_work_very_high.csv', 
                    select_var_list=c("work_very_high", 
                                      "empofc_p","empsvc_p", "empedu_p",	"empfoo_p", 
                                      "empgov_p",	"empind_p",	"empmed_p"),
                    all_lu_vars=all_lu_vars)
```
# University can't get this model to estimate when include stuuni_p

```{r}
school_loc_lu_uni<- school_loc_lu%>%
select(zone, university,   stuuni_p, empedu_p)
```


won't estimate

```{r}
#estimate_size_terms(school_loc_lu_uni, 'outputs/school_university.csv', all_lu_vars)
```

```{r}
ggplot(school_loc_lu_uni, aes(x=stuuni_p, y=university))+geom_point()

```





```{r}
ggplot(school_loc_lu_uni, aes(x=empedu_p, y=university))+geom_point()+geom_smooth( method="lm", se = TRUE)

```
Alternatively estimate a linear model and see what happens
```{r}
fitted_model_university<-glm(university ~ stuuni_p+ empedu_p-1, data=school_loc_lu_uni)
summary(fitted_model_university)
```


## Gradeschool
# won't estimate

```{r}
school_loc_lu_gradeschool<- school_loc_lu%>%
select(zone, gradeschool, stugrd_p,empedu_p)
```

## won't estimate
```{r}
#estimate_size_terms(school_loc_lu_gradeschool, 'outputs/school_gradeschool.csv', all_lu_vars)
```


```{r}
fitted_model_gradeschool<-glm(gradeschool ~ stugrd_p +empedu_p-1, data=school_loc_lu_gradeschool)
summary(fitted_model_gradeschool)
```
## high school
```{r}
school_loc_lu_highschool<- school_loc_lu%>%
select(zone, highschool, stuhgh_p,empedu_p)
```

## won't estimate
```{r}
#estimate_size_terms(school_loc_lu_highschool, 'outputs/school_highschool.csv', all_lu_vars)
```

```{r}
fitted_model_highschool<-glm(highschool ~ stuhgh_p +empedu_p-1, data=school_loc_lu_highschool)
summary(fitted_model_highschool)
```

## Non-mandatory escort
```{r non_mandatory_escort}
estimate_size_terms(non_mandatory_tour_lu, 
                    outfilename='outputs/non_mandatory_escort.csv', 
                    select_var_list=c("escort", 
                                      "empsvc_p", "stugrd_p", "stuhgh_p", "empedu_p", 
                                      "empret_p", "empfoo_p", "hh_p"),
                    all_lu_vars=all_lu_vars)
```
## Non-mandatory shopping
```{r non_mandatory_shopping}
estimate_size_terms(non_mandatory_tour_lu, 
                    outfilename='outputs/non_mandatory_shopping.csv', 
                    select_var_list=c("shopping", 
                                      "empret_p", "empfoo_p", "empsvc_p"),
                    all_lu_vars=all_lu_vars)
```

## Non-mandatory eatout
```{r non_mandatory_eat}
estimate_size_terms(non_mandatory_tour_lu, 
                    outfilename='outputs/non_mandatory_eat.csv', 
                    select_var_list=c("eatout", 
                                      "empfoo_p", "empret_p"),
                    all_lu_vars=all_lu_vars)
```
```{r non_mandatory_othmaint}
estimate_size_terms(non_mandatory_tour_lu, 
                    outfilename='outputs/non_mandatory_othmaint.csv', 
                    select_var_list=c("othmaint", 
                                      "empsvc_p","empmed_p",  "empedu_p",	"empfoo_p", 
                                      "empgov_p",	"empofc_p",		"empret_p"),
                    all_lu_vars=all_lu_vars)
```

```{r non_mandatory_social}
estimate_size_terms(non_mandatory_tour_lu, 
                    outfilename='outputs/non_mandatory_social.csv', 
                    select_var_list=c("social", 
                                      "empsvc_p", "empfoo_p", "empedu_p","empmed_p",	
                                      "empret_p",	"hh_p", "log_aparks"),
                    all_lu_vars=all_lu_vars)

```
```{r non_mandatory_othdiscr}

estimate_size_terms(non_mandatory_tour_lu, 
                    outfilename='outputs/non_mandatory_othdiscr.csv', 
                    select_var_list=c("othdiscr", 
                                      "empsvc_p", "empedu_p",	"empfoo_p","empret_p",	"hh_p",
                                      "log_aparks"),
                    all_lu_vars=all_lu_vars)
```
## At Work

wb_sub_lu

empsvc_p, empedu_p,	empfoo_p, empgov_p,	empind_p,	empmed_p,	empofc_p,	empoth_p,	empret_p,	hh_p, log_aparks
```{r atwork}
estimate_size_terms(wb_sub_lu, 
                    outfilename='outputs/atwork.csv', 
                    select_var_list=c("atwork", 
                                      "empfoo_p","empsvc_p","empofc_p","empmed_p","empret_p",
                                      "log_aparks"),
                    all_lu_vars=all_lu_vars)
```
### Intermediate Stops/Trip Ends

```{r work_size}
estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/work_size.csv', 
                    select_var_list=c("work", 
                                      "empofc_p","empsvc_p", "empedu_p",	"empfoo_p", "empgov_p"),
                    all_lu_vars=all_lu_vars)
```
```{r}

estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/escort_size.csv', 
                    select_var_list=c("escort", 
                                      "empsvc_p","empedu_p",  "empret_p", "empmed_p", "stugrd_p",
                                      "stuhgh_p", "log_aparks"),
                    all_lu_vars=all_lu_vars)

```
```{r shopping_size}
estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/shopping_size.csv', 
                    select_var_list=c("shopping", 
                                      "empret_p", "empfoo_p", "empsvc_p"),
                    all_lu_vars=all_lu_vars)

```

```{r eatout_size}
estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/eatout_size.csv', 
                    select_var_list=c("eatout", 
                                      "empfoo_p", "empret_p", "empsvc_p"),
                    all_lu_vars=all_lu_vars)

```


```{r othmaint_size}
estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/othmaint_size.csv', 
                    select_var_list=c("othmaint", 
                                      "empfoo_p","empsvc_p","empgov_p", "empmed_p","empret_p",
                                      "log_aparks"),
                    all_lu_vars=all_lu_vars)
```


```{r social_size}
estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/social_size.csv', 
                    select_var_list=c("social", 
                                      "empsvc_p", "empfoo_p", "hh_p", "empret_p"),
                    all_lu_vars=all_lu_vars)

```



```{r other_discr_size}
estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/other_discr_size.csv', 
                    select_var_list=c("othdiscr", 
                                      "empsvc_p","empedu_p","empfoo_p","empret_p","hh_p",
                                      "log_aparks"),
                    all_lu_vars=all_lu_vars)
```

# University
I'm going to constrain this to one. I'm just not sure we want university students attracted to education jobs.
```{r univeristy_size}
estimate_size_terms(trip_dest_lu, 
                    outfilename='outputs/univeristy_size.csv', 
                    select_var_list=c("univ", 
                                      "empedu_p","stuuni_p"),
                    all_lu_vars=all_lu_vars)

```




